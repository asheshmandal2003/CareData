<% layout('layout/boilerplate') %>
<link rel="stylesheet" href="/css/icon.css" />
<link rel="stylesheet" href="/css/uploadPage.css" />

<div class="row">
  <div class="general-menu col-2">
    <div class="options mt-5">
      <div class="card-text">
        <ion-icon name="document-outline" class="icon"></ion-icon
        ><span class="fw-medium"
          ><a
            href="/caredata/users/<%= user._id %>/files"
            class="links text-dark"
            >My Files</a
          ></span
        >
      </div>
      <div class="card-text">
        <ion-icon name="share-social-outline" class="icon"></ion-icon
        ><span class="fw-medium">Shared Files</span>
      </div>
      <div class="card-text">
        <ion-icon name="star-outline" class="icon"></ion-icon
        ><span class="fw-medium">Favorites</span>
      </div>
      <div class="card-text">
        <ion-icon name="trash-outline" class="icon"></ion-icon
        ><span class="fw-medium">Recycle Bin</span>
      </div>
      <div class="card-text">
        <ion-icon name="settings-outline" class="icon"></ion-icon
        ><span class="fw-medium">Settings</span>
      </div>
    </div>
  </div>

  <div class="col-10">
    <div class="ms-4">
      <% if(user.files.length){ %>
      <h4 class="mb-4">Recently Added</h4>
      <div class="recently-edited mb-4">
        <% for(let i = 0; i<(user.files.length<3? user.files.length:3); i++){ %>
        <div class="recently-edited-file me-5">
          <div class="recently-edited-file-img w-100 mb-3">
            <a
              class="img-container"
              href="/caredata/users/<%= user._id %>/upload/<%= user.files[i]._id %>"
            >
              <img
                src="<%= user.files[i].thumbnail %>"
                class="image img-fluid"
                alt="img"
              />
            </a>
          </div>
          <div class="recently-edited-file-details ms-3">
            <div class="recently-edited-file-name-time">
              <div class="recently-edited-file-name">
                <b
                  ><a
                    style="text-decoration: none"
                    class="text-dark"
                    href="/caredata/users/<%= user._id %>/upload/<%= user.files[i]._id %>"
                    ><%= user.files[i].originalname %>
                  </a></b
                >
              </div>
              <div class="recently-edited-file-time">
                <small class="text-secondary"
                  >Added <%= moment(user.files[i].createdAt).fromNow() %></small
                >
              </div>
            </div>
            <div class="more-options me-3">
              <h5 style="cursor: pointer">...</h5>
            </div>
          </div>
        </div>
        <% } %>
      </div>
      <% } %>

      <div class="upload-files">
        <h4 class="mb-4">Upload File</h4>
        <p class="account_no"></p>
        <div class="upload-container mb-4">
          <form
            class="upload-form"
            action="/caredata/users/<%= user._id %>/upload"
            method="post"
            enctype="multipart/form-data"
          >
            <label for="images" class="drop-container" id="dropcontainer">
              <span class="drop-title">Drop your files here</span>
              <small class="text-secondary" style="font-size: smaller"
                >Support pdf, jpeg, jpg, png files</small
              >
              or
              <input
                type="file"
                id="images"
                name="image"
                class="mb-3 file-input uploadFile"
                accept="image/*,application/pdf"
                required
              />
            </label>
            <button class="btn btn-primary w-100 mt-3" type="submit">
              Upload
            </button>
          </form>
        </div>
      </div>
      <ul class="img-list">
      </ul>
      <% if(user.files.length){ %>
      <div class="user-files mb-5">
        <h4 class="mb-4">Your Files</h4>
        <table class="table">
          <thead class="table-secondary">
            <tr>
              <th scope="col">Name</th>
              <th scope="col">Date</th>
              <th scope="col">Size</th>
            </tr>
          </thead>
          <tbody>
            <% user.files.map((file)=>{ %>
            <tr>
              <td class="text-secondary d-flex" style="cursor: pointer">
                <% if(file.originalname.endsWith('pdf')){ %>
                <ion-icon name="document-outline" class="icon"></ion-icon>
                <% }else{ %><ion-icon
                  name="image-outline"
                  class="icon"
                ></ion-icon>
                <% } %>
                <a
                  class="text-secondary links"
                  href="/caredata/users/<%= user._id %>/upload/<%= file._id %>"
                  ><%= file.originalname %></a
                >
              </td>
              <td class="text-secondary">
                <%= String(file.createdAt).slice(3, 10) %>, <%=
                String(file.createdAt).slice(11, 15) %>
              </td>
              <td class="text-secondary">
                <%= Math.round(file.size/1024) > 1024 ?
                (file.size/(1024*1024)).toFixed(2): Math.round(file.size/1024)%>
                <%= Math.round(file.size/1024) > 1024 ? "MB" : "KB" %>
              </td>
            </tr>
            <% }) %>
          </tbody>
        </table>
      </div>
      <% } %>
    </div>
  </div>
</div>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script src="/js/uploadPage.js" type="module"></script>
