<%- layout('layout/boilerplate') %>
<link rel="stylesheet" href="/css/icon.css" />
<link rel="stylesheet" href="/css/doctor.css" />

<section class="find-doctors-container">
  <section class="search-bar">
    <div class="search-input">
      <div class="search-icon">
        <i class="fa-solid fa-magnifying-glass" style="color: #75797e"></i>
      </div>
      <input type="text" id="doctor-search" placeholder="Search doctors" />
      <!-- <button id="search-button">Search</button> -->
    </div>
  </section>
</section>
<script>
  const searchInput = document.getElementById("doctor-search");
  const doctorsList = document.querySelector(".doctors-list");

  searchInput.addEventListener("input", () => {
    const searchTerm = searchInput.value.toLowerCase();
    filterAndRenderDoctors(searchTerm);
  });

  searchInput.addEventListener("keydown", (event) => {
    if (event.key === "Enter") {
      event.preventDefault();
      const searchTerm = searchInput.value.toLowerCase();
      filterAndRenderDoctors(searchTerm);
    }
  });

  async function fetchDoctorData() {
    try {
      const response = await fetch("");
      const data = await response.json();
      return data;
    } catch (error) {
      console.error("Error fetching doctor data:", error);
      return [];
    }
  }
  async function filterAndRenderDoctors(searchTerm) {
    doctorsList.innerHTML = "";
    const doctorData = await fetchDoctorData();
    const filteredDoctors = doctorData.filter(
      (doctor) =>
        doctor.name.toLowerCase().includes(searchTerm) ||
        doctor.specialty.toLowerCase().includes(searchTerm)
    );
    filteredDoctors.forEach((doctor) => {
      const doctorCard = document.createElement("div");
      doctorCard.className = "doctor-card";
      doctorCard.innerHTML = `
            <h3 class="doctor-name">${doctor.name}</h3>
            <p class="doctor-specialty">${doctor.specialty}</p>
            <p class="doctor-experience">${
              doctor.experience
            } experience overall</p>
            <p class="doctor-location">${doctor.location}</p>
            <p class="doctor-clinics">${doctor.clinics.join(", ")}</p>
            <p class="doctor-consultation">₹${
              doctor.consultation
            } Consultation at clinic</p>
            <div class="doctor-date">
                <p class="appointment-date">${doctor.appointmentDate}</p>
            </div>
        `;
      doctorsList.appendChild(doctorCard);
    });
  }
  filterAndRenderDoctors("");
</script>
<section class="doctors-list">
  <% doctors.map(doctor=>{ %> <% if(doctor.entryType === "doctor"){ %>
  <div class="doctor-card container grid grid-three-col">
    <div>
      <img class="doctor-img" src="/image/doctor-img.png" alt="Doctor-Image" />
    </div>
    <div class="doctor-info">
      <h2 class="name"><%= doctor.fullName %></h2>
      <p class="specialty"><%= doctor.doctorDetails.speciality %></p>
      <p class="experience">
        <%= doctor.doctorDetails.experience %> years experience overall
      </p>
      <p class="location"><%= doctor.doctorDetails.location %></p>
      <p class="clinics">Orange Clinic +2 more</p>
      <p class="consultation">₹6000 Consultation at clinic</p>
      <hr class="line" id="doctor-line" />
      <!-- <p class="profile-rating">
                    <span class="stars fa-solid fa-star" style="color: #ffc700;"></span>
                    <span class="stars fa-solid fa-star" style="color: #ffc700;"></span>
                    <span class="stars fa-solid fa-star" style="color: #ffc700;"></span>
                    <span class="stars fa-solid fa-star" style="color: #ffc700;"></span>
                    <span class="stars fa-solid fa-star" style="color: #ffc700;"></span>
                </p> -->
    </div>
    <div class="booking">
      <div class="date-icon">
        <i
          class="calen-icon fa-solid fa-calendar-days"
          style="color: #292d32"
        ></i>
        <p class="appointment-date">Available on: Sun, 12 Aug</p>
      </div>
      <a href="/doctorsProfile" class="doctor-btn">Book Appointment</a>
    </div>
  </div>
  <% } %> <% }) %>
</section>
