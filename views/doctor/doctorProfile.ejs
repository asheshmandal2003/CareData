<%- layout('layout/boilerplate') %>
<link rel="stylesheet" href="/css/icon.css" />
<link rel="stylesheet" href="/css/doctorProfile.css" />

<div class="profile-outer">
  <% if (user && user.username === doctor.username) { %>
  <aside class="sidebar-menu">
    <nav class="menu-nav" aria-label="Profile navigation">
      <button
        class="menu-option active"
        role="button"
        aria-label="Show profile"
      >
        <ion-icon name="person-circle-outline"></ion-icon>Profile
      </button>
      <button class="menu-option" role="button" aria-label="Shared files">
        <ion-icon name="documents-outline"></ion-icon>Files
      </button>
      <button class="menu-option" role="button" aria-label="Show appointments">
        <ion-icon name="calendar-outline"></ion-icon>Appointments
      </button>
      <button class="menu-option" role="button" aria-label="Video call">
        <ion-icon name="videocam-outline"></ion-icon>Video
      </button>
      <button class="menu-option" role="button" aria-label="Settings">
        <ion-icon name="settings-outline"></ion-icon>Settings
      </button>
    </nav>
  </aside>
  <% } %>

  <main
    class="profile-main <%= (user && user.username === doctor.username) ? 'has-sidebar' : '' %>"
  >
    <section class="info-header">
      <div>
        <img
          class="profile-photo"
          src="<%= doctor.doctorDetails?.profilePhotoUrl || doctor.image?.path %>"
          alt="Dr. <%= doctor.fullName %>"
        />
      </div>
      <div class="info-header-details">
        <h1><%= doctor.fullName %></h1>
        <div class="doctor-specialty">
          <%= doctor.doctorDetails?.speciality || '-' %>
        </div>
        <div class="doctor-tags">
          <% if (doctor.doctorDetails?.subSpecialities?.length) {
          doctor.doctorDetails.subSpecialities.forEach(tag=>{ %>
          <span class="tag"><%= tag %></span>
          <% }) } %>
        </div>
        <div class="exp-fees">
          <span
            ><i class="fa-solid fa-hourglass-half"></i> <%=
            doctor.doctorDetails?.experience != null ?
            `${doctor.doctorDetails.experience} yrs` : '-' %></span
          >
          <span
            ><i class="fa-solid fa-dollar-sign"></i> â‚¹<%=
            doctor.doctorDetails?.fees != null ? doctor.doctorDetails.fees : '-'
            %></span
          >
        </div>
      </div>
    </section>

    <% if (doctor.doctorDetails) { %>
    <section class="info-section">
      <div class="info-grid">
        <div>
          <div class="ico-label">
            <i class="fa-solid fa-user-graduate"></i> Education
          </div>
          <div class="val"><%= doctor.doctorDetails.education || '-' %></div>
        </div>
        <div>
          <div class="ico-label">
            <i class="fa-solid fa-hospital"></i> Clinic
          </div>
          <div class="val"><%= doctor.doctorDetails.clinicName || '-' %></div>
          <div class="minor">
            <i class="fa-solid fa-location-dot"></i> <%=
            doctor.doctorDetails.clinicAddress || doctor.doctorDetails.location
            || '-' %>
          </div>
        </div>
        <div>
          <div class="ico-label"><i class="fa-solid fa-phone"></i> Contact</div>
          <div class="val">
            <%= doctor.doctorDetails.contactNumber || '-' %>
          </div>
          <div class="minor">
            <i class="fa-regular fa-envelope"></i> <%=
            doctor.doctorDetails.email || '-' %>
          </div>
        </div>
        <div>
          <div class="ico-label">
            <ion-icon name="language"></ion-icon> Languages
          </div>
          <div>
            <% (doctor.doctorDetails.language || []).forEach(lan => { %>
            <span class="chip"><%= lan %></span>
            <% }) %>
          </div>
        </div>
        <div>
          <div class="ico-label">
            <i class="fa-regular fa-id-card"></i> Reg. ID
          </div>
          <div class="val"><%= doctor.doctorDetails.regId || '-' %></div>
        </div>
        <div>
          <div class="ico-label"><i class="fa-solid fa-trophy"></i> Awards</div>
          <div>
            <% (doctor.doctorDetails.awards || []).forEach(award => { %>
            <span class="chip award"><%= award %></span>
            <% }) %>
          </div>
        </div>
        <div>
          <div class="ico-label">
            <i class="fa-solid fa-certificate"></i> Certifications
          </div>
          <div>
            <% (doctor.doctorDetails.certifications || []).forEach(cert => { %>
            <span class="chip cert"><%= cert %></span>
            <% }) %>
          </div>
        </div>
        <div>
          <div class="ico-label"><i class="fa-solid fa-list"></i> Services</div>
          <div>
            <% (doctor.doctorDetails.services || []).forEach(svc => { %>
            <span class="chip service"><%= svc %></span>
            <% }) %>
          </div>
        </div>
        <div>
          <div class="ico-label">
            <ion-icon name="people-circle"></ion-icon> Consultation
          </div>
          <div>
            <% (doctor.doctorDetails.consultationTypes || []).forEach(type => {
            %>
            <span class="chip consult"><%= type %></span>
            <% }) %>
          </div>
        </div>
        <div>
          <div class="ico-label">
            <i class="fa-regular fa-clock"></i> Clinic Timings
          </div>
          <div>
            <% (doctor.doctorDetails.clinicTimings || []).forEach(ct => { %>
            <span class="chip timing"
              ><%= ct.day %>: <%= ct.open %>-<%= ct.close %></span
            >
            <% }) %> <% if (!(doctor.doctorDetails.clinicTimings||[]).length) {
            %>
            <span>-</span>
            <% } %>
          </div>
        </div>
      </div>
    </section>
    <section class="about-section">
      <h2>About Doctor</h2>
      <p>
        <%= doctor.doctorDetails.aboutDoctor || 'No biography available.' %>
      </p>
    </section>
    <section class="sociallinks-section">
      <% if (doctor.doctorDetails.socialLinks) { const s =
      doctor.doctorDetails.socialLinks; %> <% if(s.website) { %><a
        href="<%=s.website%>"
        target="_blank"
        aria-label="Website"
        ><ion-icon name="globe-outline"></ion-icon></a
      ><% } %> <% if(s.linkedin) { %><a
        href="<%=s.linkedin%>"
        target="_blank"
        aria-label="LinkedIn"
        ><ion-icon name="logo-linkedin"></ion-icon></a
      ><% } %> <% if(s.facebook) { %><a
        href="<%=s.facebook%>"
        target="_blank"
        aria-label="Facebook"
        ><ion-icon name="logo-facebook"></ion-icon></a
      ><% } %> <% if(s.twitter) { %><a
        href="<%=s.twitter%>"
        target="_blank"
        aria-label="Twitter"
        ><ion-icon name="logo-twitter"></ion-icon></a
      ><% } %> <% if(s.instagram) { %><a
        href="<%=s.instagram%>"
        target="_blank"
        aria-label="Instagram"
        ><ion-icon name="logo-instagram"></ion-icon></a
      ><% } %> <% } %>
    </section>
    <% } %> <% if (user && user.username === doctor.username) { %>
    <div class="profile-actions">
      <!-- <a href="/users/<%= doctor._id %>/edit" class="btn-action edit"
        >Edit Profile</a
      >
      <form action="/logout" method="POST" class="logout-form">
        <button type="submit" class="btn-action logout">Log Out</button>
      </form>
      <a
        href="/doctors/<%= doctor._id %>/adddetails"
        class="btn-action add-details"
        >Add Details</a
      > -->
      <a
        type="button"
        href="/caredata/users/<%= doctor._id %>/edit"
        class="btn btn-warning w-100"
        >Edit
      </a>
      <form action="/logout" method="post" class="w-100">
        <button class="btn btn-danger w-100">Log Out</button>
      </form>
      <a
        href="/caredata/doctors/<%= doctor._id %>/adddetails"
        type="button"
        class="btn btn-success w-100"
        >Add Details</a
      >
    </div>
    <% } %> <% if (user && user.username === doctor.username &&
    doctor.appointments) { %>
    <section class="appointments-section">
      <h2>Your Appointments</h2>
      <div class="appointments-grid">
        <% doctor.appointments.forEach((appointment, idx) => { %>
        <div class="appointment-card">
          <div class="apt-row">
            <strong>#<%= idx + 1 %></strong>
            <span class="apt-opt">Accept | Decline</span>
          </div>
          <div class="apt-row">
            <ion-icon name="person-outline"></ion-icon> <%= appointment.name %>
          </div>
          <div class="apt-row">
            <ion-icon name="call-outline"></ion-icon> <%= appointment.phone %>
          </div>
          <div class="apt-row">
            <ion-icon name="mail-outline"></ion-icon> <%= appointment.email %>
          </div>
          <div class="apt-row">
            <ion-icon name="calendar-clear-outline"></ion-icon> <%=
            appointment.date %> at <%= appointment.timeslot %> AM
          </div>
        </div>
        <% }) %>
      </div>
    </section>
    <% } %> <% if (user && user.entryType !== 'doctor') { %>
    <aside class="booking-sidebar">
      <div class="clinic-hours">
        <h3>Clinic Hours</h3>
        <p>
          <%= doctor.doctorDetails?.clinicTimings &&
          doctor.doctorDetails.clinicTimings.length ?
          doctor.doctorDetails.clinicTimings.map(t => `${t.day}:
          ${t.open}-${t.close}`).join(', ') : "N/A" %>
        </p>
      </div>
      <div class="booking-actions">
        <a
          href="/doctors/<%= doctor._id %>/bookappointment"
          class="btn booking primary-btn"
          >Book Appointment</a
        >
        <button class="btn booking secondary-btn">Video Consult</button>
      </div>
    </aside>
    <% } %>
  </main>
</div>

<script src="/js/doctorProfile.js"></script>
