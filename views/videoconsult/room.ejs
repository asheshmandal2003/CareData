<%- layout('layout/boilerplate') %>

<link rel="stylesheet" href="/css/videoconsult.css" />

<div class="dashboard-container">
  <h1 class="welcome-h1">Welcome to the Video Chat Dashboard</h1>

  <!-- Form POSTs username to server route that creates room -->
  <form id="nameForm" action="/create-room" method="POST" novalidate>
    <label for="username">Enter your name:</label>
    <input type="text" id="username" name="username" required />
    <button type="submit">Start Video Chat</button>
  </form>

  <hr />

  <label for="link">Enter the link to join:</label>
  <input
    type="text"
    id="link"
    name="link"
    placeholder="Paste full room URL here"
  />
  <button type="button" id="joinButton">Join</button>
</div>

<script>
  const joinButton = document.getElementById("joinButton");
  const linkInput = document.getElementById("link");

  joinButton.addEventListener("click", () => {
    const linkValue = linkInput.value.trim();

    if (!linkValue) {
      alert("Please enter a room link to join.");
      return;
    }

    let username = prompt("Please enter your name to join the meeting:");

    if (!username || username.trim() === "") {
      alert("Username is required to join the meeting.");
      return;
    }

    let url;
    try {
      url = new URL(linkValue);
    } catch {
      alert("Please enter a valid URL.");
      return;
    }

    if (!url.searchParams.has("username")) {
      url.searchParams.append("username", username.trim());
    }

    window.location.href = url.toString();
  });
</script>
